# ä½¿ç”¨ NVIDIA æœ€æ–° CUDA 13.0 é•œåƒ
FROM nvidia/cuda:13.0.0-cudnn-devel-ubuntu22.04

# å¼•å…¥ uv (æé€ŸåŒ…ç®¡ç†å™¨)
COPY --from=ghcr.io/astral-sh/uv:latest /uv /bin/uv

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV DEBIAN_FRONTEND=noninteractive
# å‘Šè¯‰ uv å®‰è£…åˆ°ç³»ç»Ÿç¯å¢ƒï¼Œè€Œä¸æ˜¯åˆ›å»º venv
ENV UV_SYSTEM_PYTHON=1

# 1. å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    python3 \
    python3-pip \
    python3-dev \
    git \
    wget \
    curl \
    python-is-python3 \
    && rm -rf /var/lib/apt/lists/*

# 2. ä½¿ç”¨ uv å®‰è£… PyTorch (å°è¯• cu130 å°é²œç‰ˆ)
# uv çš„ä¸‹è½½ç¨³å®šæ€§é€šå¸¸ä¼˜äº pip
RUN uv pip install --pre torch torchvision torchaudio --index-url https://download.pytorch.org/whl/nightly/cu130

# 3. å®‰è£…æ„å»ºä¾èµ–
RUN uv pip install packaging ninja setuptools wheel psutil

# 4. å®‰è£… Evo2 åŠç›¸å…³ä¾èµ–
RUN uv pip install \
    transformers \
    scipy \
    biopython \
    einops \
    flash-attn --no-build-isolation \
    stripedhyena

# 5. è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /workspace

# 6. éªŒè¯ç¯å¢ƒ
CMD ["bash", "-c", "nvcc --version && python3 -c \"import torch; print(f'ğŸ”¥ PyTorch: {torch.__version__}'); print(f'ğŸš€ CUDA (PyTorch internal): {torch.version.cuda}'); print(f'âœ… GPU: {torch.cuda.get_device_name(0) if torch.cuda.is_available() else 'None'}\""]

