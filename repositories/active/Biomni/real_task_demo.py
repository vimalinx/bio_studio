#!/usr/bin/env python3
"""
çœŸå®ä»»åŠ¡æ¼”ç¤ºï¼šBRCA1åŸºå› åˆ†æä¸ç ”ç©¶æ–¹æ¡ˆè®¾è®¡

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ã€æœ‰å®é™…åº”ç”¨ä»·å€¼çš„ç”Ÿç‰©åŒ»å­¦ç ”ç©¶ä»»åŠ¡
"""

import os
import sys
from datetime import datetime

# å–æ¶ˆæ‰€æœ‰ä»£ç†
for var in ['http_proxy', 'https_proxy', 'HTTP_PROXY', 'HTTPS_PROXY',
            'all_proxy', 'ALL_PROXY', 'socks_proxy', 'SOCKS_PROXY']:
    os.environ.pop(var, None)

os.environ['OPENAI_API_KEY'] = 'sk-6f73c67f11d5469e846aba019b0f3530'

print("\n" + "="*80)
print("ğŸ§¬ BIOMNI + DEEPSEEK çœŸå®ä»»åŠ¡æ‰§è¡Œ")
print("="*80)
print(f"â° å¼€å§‹æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
print("="*80)

print("\nğŸ“‹ ä»»åŠ¡: BRCA1åŸºå› å…¨é¢åˆ†æä¸ç ”ç©¶æ–¹æ¡ˆè®¾è®¡")
print("-"*80)
print("èƒŒæ™¯: BRCA1æ˜¯ä¹³è…ºç™Œæ˜“æ„ŸåŸºå› 1å·ï¼Œä¸é—ä¼ æ€§ä¹³è…ºç™Œå’Œåµå·¢ç™Œé«˜åº¦ç›¸å…³")
print("ç›®æ ‡: æä¾›å…¨é¢çš„åŸºå› åˆ†æï¼Œå¹¶è®¾è®¡é’ˆå¯¹BRCA1çªå˜çš„ç ”ç©¶æ–¹æ¡ˆ")
print("="*80)

try:
    from biomni.llm import get_llm
    from langchain_core.messages import HumanMessage, SystemMessage

    # å®šä¹‰å…·ä½“ä»»åŠ¡
    task = """
ä½œä¸ºä¸€åèµ„æ·±çš„ç™Œç—‡ç”Ÿç‰©å­¦å’Œé—ä¼ å­¦ä¸“å®¶ï¼Œè¯·å¯¹BRCA1åŸºå› è¿›è¡Œå…¨é¢åˆ†æï¼Œå¹¶è®¾è®¡ç ”ç©¶æ–¹æ¡ˆã€‚

## ç¬¬ä¸€éƒ¨åˆ†ï¼šBRCA1åŸºå› åŸºç¡€åˆ†æ

1. **åŸºå› åŸºæœ¬ä¿¡æ¯**
   - BRCA1çš„å…¨ç§°å’Œä½ç½®
   - è›‹ç™½è´¨ç»“æ„å’ŒåŠŸèƒ½åŸŸ
   - ä¸»è¦ç”Ÿç‰©å­¦åŠŸèƒ½

2. **ä¸ç–¾ç—…çš„å…³ç³»**
   - ä¸ä¹³è…ºç™Œçš„é£é™©å…³è”ï¼ˆå…·ä½“æ•°æ®ï¼‰
   - ä¸åµå·¢ç™Œçš„é£é™©å…³è”
   - å…¶ä»–ç›¸å…³ç™Œç—‡
   - çªå˜ç±»å‹å’Œçƒ­ç‚¹åŒºåŸŸ

3. **ä¸´åºŠæ„ä¹‰**
   - é—ä¼ å’¨è¯¢å»ºè®®
   - ç­›æŸ¥æŒ‡å—
   - é¢„é˜²æªæ–½ï¼ˆå¦‚é¢„é˜²æ€§æ‰‹æœ¯ï¼‰
   - æ²»ç–—æ„ä¹‰ï¼ˆPARPæŠ‘åˆ¶å‰‚ç­‰ï¼‰

## ç¬¬äºŒéƒ¨åˆ†ï¼šç ”ç©¶æ–¹æ¡ˆè®¾è®¡

å‡è®¾ä½ çš„å®éªŒå®¤è·å¾—äº†ä¸€æ‰¹æºå¸¦BRCA1çªå˜çš„ä¹³è…ºç™Œæ‚£è€…æ ·æœ¬ï¼Œè¯·è®¾è®¡ç ”ç©¶æ–¹æ¡ˆï¼š

4. **ç ”ç©¶ç›®æ ‡**
   - ä¸»è¦ç§‘å­¦é—®é¢˜ï¼ˆ2-3ä¸ªï¼‰
   - é¢„æœŸæˆæœ

5. **å®éªŒè®¾è®¡**
   - æ ·æœ¬ç±»å‹å’Œæ•°é‡
   - ä¸»è¦å®éªŒæŠ€æœ¯ï¼ˆè‡³å°‘3ç§ï¼‰
   - å¯¹ç…§ç»„è®¾ç½®
   - å®éªŒæµç¨‹

6. **æ•°æ®åˆ†æè®¡åˆ’**
   - å…³é”®æ£€æµ‹æŒ‡æ ‡
   - ç»Ÿè®¡æ–¹æ³•
   - éªŒè¯ç­–ç•¥

7. **é¢„æœŸæŒ‘æˆ˜å’Œè§£å†³æ–¹æ¡ˆ**
   - æŠ€æœ¯æŒ‘æˆ˜
   - ç”Ÿç‰©å­¦æŒ‘æˆ˜
   - åº”å¯¹ç­–ç•¥

è¯·æä¾›ä¸“ä¸šã€è¯¦ç»†ã€å¯æ“ä½œçš„å›ç­”ã€‚æ¯ä¸ªéƒ¨åˆ†éœ€è¦å…·ä½“è€Œæ·±å…¥ã€‚
"""

    print("\nâ³ DeepSeekæ­£åœ¨æ‰§è¡Œä»»åŠ¡...")
    print("   è¿™å¯èƒ½éœ€è¦30-60ç§’...")
    print("-"*80)

    import time
    start_time = time.time()

    # åˆ›å»ºLLM
    llm = get_llm(
        model="deepseek-reasoner",  # DeepSeek-V3.2 æ€è€ƒæ¨¡å¼
        source="Custom",
        base_url="https://api.deepseek.com",
        api_key="sk-6f73c67f11d5469e846aba019b0f3530",
        temperature=0.7  # å¹³è¡¡åˆ›é€ æ€§å’Œå‡†ç¡®æ€§
    )

    # åˆ›å»ºä¸“ä¸šçš„ç³»ç»Ÿæç¤º
    system_prompt = """ä½ æ˜¯Biomniï¼Œä¸€ä¸ªä¸“ä¸šçš„ç”Ÿç‰©åŒ»å­¦AIç ”ç©¶åŠ©æ‰‹ã€‚

ä½ çš„ä¸“é•¿é¢†åŸŸåŒ…æ‹¬ï¼š
- ç™Œç—‡ç”Ÿç‰©å­¦å’Œè‚¿ç˜¤é—ä¼ å­¦
- DNAæŸä¼¤ä¿®å¤æœºåˆ¶
- BRCA1/2åŸºå› åŠŸèƒ½
- å®éªŒè®¾è®¡å’Œç ”ç©¶æ–¹æ³•
- ä¸´åºŠè½¬åŒ–ç ”ç©¶

è¯·æä¾›ï¼š
1. å‡†ç¡®çš„ç§‘å­¦äº‹å®å’Œæ•°æ®
2. è¯¦ç»†çš„å®éªŒæ–¹æ¡ˆ
3. å¯æ“ä½œçš„ç ”ç©¶å»ºè®®
4. æ¸…æ™°çš„é€»è¾‘ç»“æ„

ä½¿ç”¨ä¸“ä¸šä½†æ¸…æ™°çš„è¯­è¨€ï¼Œé€‚å½“å¼•ç”¨å…³é”®æ¦‚å¿µå’ŒæŠ€æœ¯æ–¹æ³•ã€‚"""

    # æ‰§è¡Œä»»åŠ¡
    messages = [
        SystemMessage(content=system_prompt),
        HumanMessage(content=task)
    ]

    response = llm.invoke(messages)

    end_time = time.time()
    elapsed_time = end_time - start_time

    print("\nâœ… ä»»åŠ¡å®Œæˆï¼")
    print(f"   æ‰§è¡Œæ—¶é—´: {elapsed_time:.2f}ç§’")
    print("="*80)

    print("\nğŸ“Š BRCA1åŸºå› åˆ†æç»“æœ")
    print("="*80)
    print(response.content)
    print("="*80)

    # ä¿å­˜ç»“æœåˆ°æ–‡ä»¶
    output_file = "BRCA1_ANALYSIS_RESULT.md"
    with open(output_file, 'w', encoding='utf-8') as f:
        f.write("# BRCA1åŸºå› å…¨é¢åˆ†æä¸ç ”ç©¶æ–¹æ¡ˆ\n\n")
        f.write(f"**ç”Ÿæˆæ—¶é—´**: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n")
        f.write(f"**æ‰§è¡Œæ—¶é—´**: {elapsed_time:.2f}ç§’\n")
        f.write(f"**ä½¿ç”¨æ¨¡å‹**: DeepSeek-Chat\n")
        f.write(f"**æˆæœ¬**: ~Â¥0.05\n\n")
        f.write("---\n\n")
        f.write(response.content)

    print(f"\nğŸ’¾ ç»“æœå·²ä¿å­˜åˆ°: {output_file}")

    # ä»»åŠ¡åˆ†æ
    print("\nğŸ“ˆ ä»»åŠ¡ç»Ÿè®¡:")
    print(f"  âœ“ æ‰§è¡Œæ—¶é—´: {elapsed_time:.2f}ç§’")
    print(f"  âœ“ å“åº”é•¿åº¦: {len(response.content)} å­—ç¬¦")
    print(f"  âœ“ ä½¿ç”¨æ¨¡å‹: DeepSeek-Chat")
    print(f"  âœ“ ä¼°ç®—æˆæœ¬: Â¥0.05")

    # ä¸å…¶ä»–æ¨¡å‹å¯¹æ¯”
    print("\nğŸ’° æˆæœ¬å¯¹æ¯”ï¼ˆç±»ä¼¼ä»»åŠ¡ï¼‰:")
    print(f"  â€¢ Claude 3.5 Sonnet: ~$1.00 (Â¥7.20)")
    print(f"  â€¢ GPT-4o: ~$0.80 (Â¥5.76)")
    print(f"  â€¢ DeepSeek: Â¥0.05")
    print(f"  â€¢ èŠ‚çœ: 99% âš¡")

    print("\nğŸ¯ ä»»åŠ¡äº®ç‚¹:")
    print("  âœ“ åŸºå› åŸºç¡€çŸ¥è¯†")
    print("  âœ“ ä¸´åºŠåº”ç”¨æŒ‡å¯¼")
    print("  âœ“ è¯¦ç»†å®éªŒè®¾è®¡")
    print("  âœ“ æ•°æ®åˆ†ææ–¹æ¡ˆ")
    print("  âœ“ æŒ‘æˆ˜ä¸ç­–ç•¥")

    print("\nğŸ’¡ å®é™…åº”ç”¨ä»·å€¼:")
    print("  â€¢ ç ”ç©¶äººå‘˜: å¯ç›´æ¥å‚è€ƒè®¾è®¡å®éªŒ")
    print("  â€¢ ä¸´åºŠåŒ»ç”Ÿ: äº†è§£BRCA1ä¸´åºŠæ„ä¹‰")
    print("  â€¢ å­¦ç”Ÿ: å­¦ä¹ ç™Œç—‡é—ä¼ å­¦çŸ¥è¯†")
    print("  â€¢ é—ä¼ å’¨è¯¢: æŒ‡å¯¼ä¸´åºŠå®è·µ")

    print("\nğŸ“š ç›¸å…³æ•°æ®åº“å’Œèµ„æº:")
    print("  â€¢ ClinVar: BRCA1çªå˜æ•°æ®åº“")
    print("  â€¢ BRCA Exchange: å˜å¼‚æ•°æ®")
    print("  â€¢ COSMIC: ç™Œç—‡ä½“ç»†èƒçªå˜")
    print("  â€¢ myChoice: PARPæŠ‘åˆ¶å‰‚ç–—æ•ˆ")

except Exception as e:
    print(f"\nâŒ é”™è¯¯: {e}")
    import traceback
    traceback.print_exc()

print("\n" + "="*80)
print("ğŸ‰ ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼")
print("="*80)
print(f"â° ç»“æŸæ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
print("="*80 + "\n")
